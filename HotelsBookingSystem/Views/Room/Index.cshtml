
@using X.PagedList
@using X.PagedList.Mvc.Core
@using HotelsBookingSystem.ViewModels
@model IPagedList<RoomViewModel>
@{
    ViewData["Title"] = "Index";
}
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<div class="container my-5">

    <form method="get" asp-action="FilterRooms" asp-controller="Room">
        <div class="row mb-3">
            <div class="col-md-2">

                <select name="type" class="form-select">
                    <option value="">-- Select Type --</option>
                    <option value="All" selected="@(ViewData["CurrentType"]?.ToString() == "All")">All</option>

                    @foreach (var type in Model.FirstOrDefault()?.typslist ?? new List<string>())
                    {
                        <option value="@type" selected="@(type == ViewData["CurrentType"]?.ToString())">@type</option>
                    }
                </select>

            </div>

            <div class="col-md-2">
                <input type="number" name="minPrice" class="form-control" placeholder="Min Price"
                       value="@ViewData["CurrentMinPrice"]" min="1" />
                <span class="text-danger" data-valmsg-for="minPrice" data-valmsg-replace="true"></span>
            </div>

            <div class="col-md-2">
                <input type="number" name="maxPrice" class="form-control" placeholder="Max Price"
                       value="@ViewData["CurrentMaxPrice"]" min="1" />
                <span class="text-danger" data-valmsg-for="maxPrice" data-valmsg-replace="true"></span>
            </div>

            <div class="col-md-2">
                <select name="hotelId" class="form-select">
                    <option value="">-- Select Hotel --</option>
                  <option value="0" selected="@(ViewData["CurrentHotelId"]?.ToString() == "All")">All</option>  

                    @foreach (var hotel in Model.FirstOrDefault()?.hotels ?? new List<Hotel>())
                    {

                        <option value="@hotel.Id"selected="@(hotel.Id.ToString() == ViewData["CurrentHotelId"]?.ToString())">
                            @hotel.Name
                        </option>
                    }
                </select>
            </div>

            <div class="col-md-2">
                <select name="city" class="form-select">
                    <option value="">-- Select City --</option>
                  <option value="All" selected="@(ViewData["CurrentCity"]?.ToString() == "All")">All</option>  

                    @foreach (var hotel in Model.FirstOrDefault()?.hotels ?? new List<Hotel>())
                    {
                        <option value="@hotel.City"
                                selected="@(hotel.City == ViewData["CurrentCity"]?.ToString())">
                            @hotel.City
                        </option>
                    }
                </select>
            </div>

            <div class="col-md-1">
                <button type="submit" class="btn btn-primary">Filter</button>
            </div>
            <div class="col-md-1">
                <a href="/Room/Index" class="btn btn-secondary">Clear</a>
            </div>
        </div>
    </form>
@if (!string.IsNullOrEmpty(ViewBag.Message as string))
{
    <div class="alert alert-warning text-center">
        @ViewBag.Message
            @ViewBag.FilterError
    </div>
}


   


    <!-- Room Start -->

    <link href="css/style.css" rel="stylesheet">
    <div class="container-xxl py-5">
        <div class="container">
            <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
                <h6 class="section-title text-center text-primary text-uppercase">Our Rooms</h6>
                <h1 class="mb-5">Explore Our <span class="text-primary text-uppercase">Rooms</span></h1>
            </div>
            <div class="row g-4">

                @if (Model == null || !Model.Any() || Model.All(r => r.Id == 0))
                {
                    <div class="alert alert-warning">
                        <strong>No rooms found matching your criteria.</strong>

                    </div>
                }
                else
                {
                    @foreach (var i in Model)
                    {
                        <div class="col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.1s">
                            <div class="room-item shadow rounded overflow-hidden">
                                <div class="position-relative">
                                    @if (i.RoomImages != null && i.RoomImages.Any())
                                    {
                                        <img class="" src="~/images/@i.RoomImages.FirstOrDefault()" height="150px" width="100%" alt="">
                                    }
                                    else
                                    {
                                        <img class="" src="~/images/default-image.jpg" height="150px" width="100%" alt="No Image Available">
                                    }
                                    <small class="position-absolute start-0 top-100 translate-middle-y bg-primary text-white rounded py-1 px-3 ms-4">$@i.PricePerNight/Night</small>
                                </div>
                                <div class="p-4 mt-2">
                                    <div class="d-flex justify-content-between mb-3">
                                        <h5 class="mb-0">@i.Type</h5>
                                        <div class="ps-2">
                                            <small class="fa fa-star text-primary"></small>
                                            <small class="fa fa-star text-primary"></small>
                                            <small class="fa fa-star text-primary"></small>
                                            <small class="fa fa-star text-primary"></small>
                                            <small class="fa fa-star text-primary"></small>
                                        </div>
                                    </div>
                                     <div class="d-flex mb-3">
                                        <small class="border-end pe-3 me-3">
                                            <i class="fa fa-bed text-primary me-2"></i> @i.NumberOfBeds
                                        </small>

                                        <small class="border-end pe-3 me-3">
                                            <i class="fa fa-wifi text-primary me-2"></i> Wifi
                                        </small>

                                        <small>
                                            <i class="fa  fa-arrow-down-9-1 text-primary me-2"></i> @i.RoomNumber
                                        </small>

                                    </div> 
                                    <div class="d-flex mb-3">
                                        <div><p>@i.hotel.Name </p></div>
                                    </div>

                                    <p class="text-body mb-3">@i.Description</p>
                                    <div class="d-flex justify-content-between">
                                        <a class="btn btn-sm btn-primary rounded py-2 px-4" href="/Room/Detail/@i.Id">View Detail</a>
                                        <a class="btn btn-sm btn-dark rounded py-2 px-4" href="">Book Now</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }

                }


            </div>
        </div>
    </div>
    <div class=" my-5 w-75 m-auto " id="map" style="height: 300px;"></div>
    <div class="pagination-container my-5 pb-5">
        <ul class="pagination justify-content-center my-5">
            @if (Model.HasPreviousPage)
            {
                <li class="page-item">
                    <a class="page-link" href="/Room/Index?page=@(Model.PageNumber - 1)">&laquo;</a>
                </li>
            }
            else
            {
                <li class="page-item disabled">
                    <span class="page-link">&laquo;</span>
                </li>
            }

            @for (int i = 1; i <= Model.PageCount; i++)
            {
                <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                    <a class="page-link" href="/Room/Index?page=@i">@i</a>
                </li>
            }

            @if (Model.HasNextPage)
            {
                <li class="page-item">
                    <a class="page-link" href="/Room/Index?page=@(Model.PageNumber + 1)">&raquo;</a>
                </li>
            }
            else
            {
                <li class="page-item disabled">
                    <span class="page-link">&raquo;</span>
                </li>
            }
        </ul>
    </div>

</div>

 

<script>
    var map = L.map('map').setView([30.0444, 31.2357], 6); // Centered on Egypt

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    var bounds = [];

    @foreach (var h in Model)
    {
        if (h.hotel != null &&
            !string.IsNullOrEmpty(h.hotel.Latitude) &&
            !string.IsNullOrEmpty(h.hotel.Longitude))
        {
         
            <text>
                        var lat = parseFloat('@h.hotel.Latitude'.replace(',', '.'));
                        var lng = parseFloat('@h.hotel.Longitude'.replace(',', '.'));

                        if (!isNaN(lat) && !isNaN(lng)) {
                            var marker = L.marker([lat, lng]).addTo(map)
                                .bindPopup(`@h.hotel.Name \n @h.hotel.Phone`);
                            bounds.push([lat, lng]);
                        }
            </text>
        }
    }

    if (bounds.length > 0) {
        map.fitBounds(bounds);
    }
</script>
<partial name="_ValidationScriptsPartial" /> 